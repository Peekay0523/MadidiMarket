{% extends 'marketplace/base.html' %}
{% load static %}

{% block title %}Credit Card Payment - Madidi Market{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Credit Card Payment</h1>

    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow p-6">
        <form method="post" action="{% url 'marketplace:process_credit_card_payment' %}">
            {% csrf_token %}
            
            <div class="mb-6">
                <h2 class="text-xl font-semibold mb-4">Card Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label for="card_holder_name" class="block text-sm font-medium text-gray-700 mb-1">Cardholder Name</label>
                        <input type="text" id="card_holder_name" name="card_holder_name" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="card_number" class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                        <input type="text" id="card_number" name="card_number" maxlength="19" required 
                               placeholder="0000 0000 0000 0000"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="expiry_date" class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                        <input type="text" id="expiry_date" name="expiry_date" maxlength="5" required 
                               placeholder="MM/YY"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="cvv" class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                        <input type="password" id="cvv" name="cvv" maxlength="4" required 
                               placeholder="123"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <h2 class="text-xl font-semibold mb-4">Billing Address</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="billing_country" class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                        <input type="text" id="billing_country" name="billing_country" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="billing_city" class="block text-sm font-medium text-gray-700 mb-1">City</label>
                        <input type="text" id="billing_city" name="billing_city" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="billing_address" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                        <input type="text" id="billing_address" name="billing_address" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="billing_postal_code" class="block text-sm font-medium text-gray-700 mb-1">Postal Code</label>
                        <input type="text" id="billing_postal_code" name="billing_postal_code" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <h2 class="text-xl font-semibold mb-4">Order Summary</h2>
                <div class="border rounded-lg p-4 bg-gray-50">
                    <div class="flex justify-between mb-2">
                        <span>Amount:</span>
                        <span class="font-medium">R{{ amount|floatformat:2 }}</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg pt-2 border-t">
                        <span>Total:</span>
                        <span>R{{ amount|floatformat:2 }}</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center justify-between">
                <a href="{% url 'marketplace:checkout' %}" class="text-blue-600 hover:text-blue-800">‚Üê Back to Checkout</a>
                <button type="submit" class="btn-primary px-6 py-3">Complete Payment</button>
            </div>
        </form>
    </div>
</div>

<script>
// Format card number as user types
document.getElementById('card_number').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
    let formattedValue = '';
    
    for (let i = 0; i < value.length; i++) {
        if (i > 0 && i % 4 === 0) {
            formattedValue += ' ';
        }
        formattedValue += value[i];
    }
    
    e.target.value = formattedValue;
});

// Format expiry date as user types
document.getElementById('expiry_date').addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^0-9]/g, '');
    
    if (value.length >= 2) {
        value = value.substring(0, 2) + '/' + value.substring(2, 4);
    }
    
    e.target.value = value;
});
</script>
{% endblock %}